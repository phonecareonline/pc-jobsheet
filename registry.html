<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Device Registry - PhoneCare</title>
    <link rel="stylesheet" href="registry.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <link rel="icon" href="register.png" type="image/png">
</head>
<body>
    <!-- Firebase Configuration Script - Add your config here -->
    <script>
        // Replace this with your actual Firebase configuration
        window.firebaseConfig = {
            apiKey: "your-api-key-here",
            authDomain: "your-project-id.firebaseapp.com",
            projectId: "your-project-id",
            storageBucket: "your-project-id.appspot.com",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };
    </script>

    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="header-left">
                <button class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i>
                    Back to Dashboard
                </button>
                <div class="page-title">
                    <i class="fas fa-clipboard-list"></i>
                    Device Registry
                </div>
            </div>
            <div class="header-right">
                <div class="stats-summary">
                    <div class="stat-item">
                        <span class="stat-value" id="totalDevices">0</span>
                        <span class="stat-label">Total Registered</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="todayDevices">0</span>
                        <span class="stat-label">Today</span>
                    </div>
                </div>
                <button class="refresh-btn" id="refreshRegistry">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="filters-content">
            <div class="filter-group">
                <label for="dateFilter">Date Range:</label>
                <select id="dateFilter">
                    <option value="all">All Time</option>
                    <option value="today">Today</option>
                    <option value="yesterday">Yesterday</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            
            <div class="filter-group custom-date-range" id="customDateRange" style="display: none;">
                <input type="date" id="startDate" placeholder="Start Date">
                <input type="date" id="endDate" placeholder="End Date">
            </div>
            
            <div class="filter-group">
                <label for="statusFilter">Status:</label>
                <select id="statusFilter">
                    <option value="all">All Status</option>
                    <option value="repair not started">Not Started</option>
                    <option value="in progress">In Progress</option>
                    <option value="completed">Completed</option>
                    <option value="handed over">Handed Over</option>
                    <option value="returned">Returned</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="priorityFilter">Priority:</label>
                <select id="priorityFilter">
                    <option value="all">All Priority</option>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                    <option value="Urgent">Urgent</option>
                </select>
            </div>
            
            <div class="search-group">
                <input type="text" id="searchRegistry" placeholder="Search by ticket ID, customer name, or mobile...">
                <button class="search-btn" onclick="applyFilters()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <button class="clear-filters-btn" onclick="clearFilters()">
                <i class="fas fa-times"></i>
                Clear Filters
            </button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="registry-container">
            <div class="registry-header">
                <h2>Registered Devices</h2>
                <div class="registry-actions">
                    <button class="export-btn" onclick="exportToCSV()">
                        <i class="fas fa-download"></i>
                        Export CSV
                    </button>
                </div>
            </div>
            
            <!-- Loading State -->
            <div class="loading-state" id="loadingState">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Loading device registry...</p>
            </div>
            
            <!-- Registry Table -->
            <div class="registry-table-container" id="registryTableContainer" style="display: none;">
                <table class="registry-table">
                    <thead>
                        <tr>
                            <th>Ticket ID</th>
                            <th>Customer</th>
                            <th>Mobile</th>
                            <th>Device</th>
                            <th>Problem</th>
                            <th>Priority</th>
                            <th>Status</th>
                            <th>Estimated Cost</th>
                            <th>Registered Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="registryTableBody">
                        <!-- Dynamic content -->
                    </tbody>
                </table>
            </div>
            
            <!-- Empty State -->
            <div class="empty-state" id="emptyState" style="display: none;">
                <i class="fas fa-clipboard-list"></i>
                <h3>No Devices Found</h3>
                <p>No devices match your current filters</p>
            </div>
        </div>
    </div>

    <!-- Receipt Modal -->
    <div class="modal" id="receiptModal">
        <div class="modal-content receipt-modal">
            <div class="modal-header">
                <h3><i class="fas fa-receipt"></i> Print Receipt</h3>
                <button class="close-btn" onclick="closeModal('receiptModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="receiptPreview"></div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeModal('receiptModal')">Cancel</button>
                <button class="btn primary" onclick="printReceipt()">
                    <i class="fas fa-print"></i>
                    Print Receipt
                </button>
            </div>
        </div>
    </div>
    <!-- Admin Authentication Modal -->
<div class="modal" id="adminAuthModal">
    <div class="modal-content admin-auth-modal">
        <div class="modal-header">
            <h3><i class="fas fa-shield-alt"></i> Admin Authentication Required</h3>
            <button class="close-btn" onclick="closeModal('adminAuthModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="auth-content">
                <div class="warning-section">
                    <i class="fas fa-exclamation-triangle warning-icon"></i>
                    <h4>Restricted Action</h4>
                    <p>You are about to permanently delete a device record. This action cannot be undone and requires administrator privileges.</p>
                </div>
                
                <div class="device-preview" id="devicePreview">
                    <!-- Device details will be populated here -->
                </div>
                
                <div class="auth-form" id="authForm">
                    <label for="adminPassword">Enter Admin Password:</label>
                    <input type="password" id="adminPassword" placeholder="Admin password" autocomplete="current-password">
                    <div class="auth-error" id="authError" style="display: none;">
                        <i class="fas fa-times-circle"></i>
                        <span>Incorrect password. Access denied.</span>
                    </div>
                </div>
                
                <div class="success-message" id="successMessage" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <h4>Authentication Successful</h4>
                    <p>You are now authorized to delete this device record.</p>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn secondary" onclick="closeModal('adminAuthModal')">Cancel</button>
            <button class="btn danger" id="verifyPasswordBtn" onclick="verifyAdminPassword()">
                <i class="fas fa-key"></i>
                Verify & Delete
            </button>
            <button class="btn danger" id="confirmDeleteBtn" onclick="proceedWithDelete()" style="display: none;">
                <i class="fas fa-trash"></i>
                Confirm Delete
            </button>
        </div>
    </div>
</div>

<style>
/* Admin Authentication Modal Styles */
.admin-auth-modal {
    max-width: 500px;
}

.auth-content {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.warning-section {
    background: linear-gradient(135deg, #fed7d7, #feb2b2);
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    border: 2px solid #fc8181;
}

.warning-icon {
    font-size: 3rem;
    color: #e53e3e;
    margin-bottom: 1rem;
    animation: pulse 2s infinite;
}

.warning-section h4 {
    color: #742a2a;
    margin-bottom: 0.5rem;
    font-weight: 700;
}

.warning-section p {
    color: #822727;
    font-size: 0.9rem;
    line-height: 1.4;
}

.device-preview {
    background: #f7fafc;
    padding: 1rem;
    border-radius: 8px;
    border-left: 4px solid #4299e1;
}

.device-preview h5 {
    color: #2d3748;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.preview-detail {
    display: flex;
    justify-content: space-between;
    padding: 0.25rem 0;
    font-size: 0.9rem;
}

.preview-label {
    color: #4a5568;
    font-weight: 500;
}

.preview-value {
    color: #2d3748;
    font-weight: 600;
}

.auth-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.auth-form label {
    font-weight: 600;
    color: #4a5568;
}

.auth-form input {
    padding: 0.875rem;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 1rem;
    transition: all 0.2s;
}

.auth-form input:focus {
    outline: none;
    border-color: #4299e1;
    box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

.auth-error {
    background: #fed7d7;
    color: #c53030;
    padding: 0.75rem;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    border: 1px solid #fc8181;
    animation: shake 0.5s ease-in-out;
}

.success-message {
    background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    border: 2px solid #68d391;
}

.success-message i {
    font-size: 3rem;
    color: #25543e;
    margin-bottom: 1rem;
}

.success-message h4 {
    color: #22543d;
    margin-bottom: 0.5rem;
    font-weight: 700;
}

.success-message p {
    color: #276749;
    font-size: 0.9rem;
}

.btn.danger {
    background: #e53e3e;
    color: white;
}

.btn.danger:hover {
    background: #c53030;
    transform: translateY(-1px);
}

.btn.danger:disabled {
    background: #a0aec0;
    cursor: not-allowed;
    transform: none;
}

/* Delete button styles */
.delete-btn {
    background: #e53e3e;
    color: white;
}

.delete-btn:hover {
    background: #c53030;
}

/* Animations */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.7; }
    100% { opacity: 1; }
}

/* Loading state for buttons */
.btn.loading {
    position: relative;
    color: transparent;
}

.btn.loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    top: 50%;
    left: 50%;
    margin-left: -8px;
    margin-top: -8px;
    border: 2px solid transparent;
    border-top-color: currentColor;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    color: white;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 768px) {
    .admin-auth-modal {
        width: 95%;
        margin: 1rem;
    }
    
    .warning-section {
        padding: 1rem;
    }
    
    .warning-icon {
        font-size: 2rem;
    }
}
</style>
    <!-- Device Details Modal -->
    <div class="modal" id="deviceDetailsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-info-circle"></i> Device Details</h3>
                <button class="close-btn" onclick="closeModal('deviceDetailsModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="deviceDetailsContent"></div>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeModal('deviceDetailsModal')">Close</button>
                <button class="btn primary" onclick="printFromDetails()">
                    <i class="fas fa-print"></i>
                    Print Receipt
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Bar -->
    <div class="notifications-bar" id="notificationsBar">
        <div class="notification-content">
            <span id="notificationMessage"></span>
            <button class="close-notification" id="closeNotification">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <!-- Hidden Print Area -->
    <div id="printableArea" class="print-only"></div>
    <!-- Print Container (Hidden) - Same as main app -->



    <script src="firebase-config.js"></script>
<script type="module" src="registry.js"></script>

</body>
</html>