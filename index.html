<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhoneCare Smart Onboarding Panel</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="add.png" type="image/png">
</head>
<body>
    <!-- Header -->
    <header class="main-header">
        <div class="header-content">
            <div class="logo-section">
                <!-- <i class="fas fa-desktop"></i> -->
                <div class="brand-info">
                    <h1>PhoneCare Device Onboarding</h1>
                    <p>Accept Devices for Repair and Handover</p>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-box">
                    <span class="stat-number" id="onlinePayments">0</span>
                    <span class="stat-label">Online Payments</span>
                </div>
                <div class="stat-box">
                    <span class="stat-number" id="readyDevices">0</span>
                    <span class="stat-label">Ready for Handover</span>
                </div>
                <div class="stat-box revenue">
                    <span class="stat-number" id="todayRevenue">₹0</span>
                    <span class="stat-label">Today's Revenue</span>
                </div>
            </div>
            <div class="header-actions">
                <div class="current-time" id="currentTime"></div>
                <button class="refresh-btn" id="refreshData">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
            </div>
        </div>
    </header>

    <!-- Notifications Bar -->
    <div class="notifications-bar" id="notificationsBar" style="display: none;">
        <div class="notification-content">
            <i class="fas fa-bell"></i>
            <span id="notificationMessage">No new notifications</span>
        </div>
        <button class="close-notification" id="closeNotification">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Quick Actions Section -->
        <section class="quick-actions-section">
            <h2><i class="fas fa-bolt"></i> Quick Actions</h2>
            <div class="actions-grid">
                <button class="action-card" id="newRegistrationBtn">
                    <i class="fas fa-plus-circle"></i>
                    <span>New Device Registration</span>
                </button>
                <button class="action-card" id="searchDeviceBtn">
                    <i class="fas fa-search"></i>
                    <span>Search Device</span>
                </button>
                <button class="action-card" id="deviceRegistryBtn" onclick="window.location.href='registry.html'">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Device Registry</span>
                </button>
                <button class="action-card" id="viewReportsBtn" onclick="window.location.href='reports.html'">
    <i class="fas fa-chart-bar"></i>
    <span>View Reports</span>
</button>

            </div>
        </section>

        <!-- Search Section -->
        <!-- Add this to your search section -->
<div class="search-section">
    <h2><i class="fas fa-magnifying-glass"></i> Smart Device Search</h2>
    <div class="search-container">
        <div class="search-methods">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Enter Ticket ID, Phone Number, or Customer Name...">
                <button class="search-btn" id="performSearch">
                    <i class="fas fa-search"></i>
                    Search
                </button>
            </div>
            <!-- NEW: Barcode scanner input -->
            <div class="barcode-search">
                <input type="text" id="barcodeInput" placeholder="Scan or enter barcode here..." class="barcode-input">
                <button class="barcode-btn" id="scanBarcodeBtn">
                    <i class="fas fa-barcode"></i>
                    Scan Barcode
                </button>
            </div>
        </div>
        <div class="search-results" id="searchResults"></div>
    </div>
</div>
        <!-- End of Search Section -->

        <!-- Main Content Tabs -->
        <section class="main-content-section">
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="handover">
                    <i class="fas fa-handshake" style="color: red;"></i>
                    <span> <b style="color: red;">Smart Handover Disabled</b> </span>
                    <span class="badge" id="handoverBadge">0</span>
                </button>
                <button class="tab-btn" data-tab="payment">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment Collection</span>
                    <span class="badge" id="paymentBadge">0</span>
                </button>
                <button class="tab-btn" data-tab="returns">
                    <i class="fas fa-undo"></i>
                    <span>Device Returns</span>
                    <span class="badge" id="returnsBadge">0</span>
                </button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content active" id="handoverContent">
                <div class="tab-header">
                    <h3><i class="fas fa-robot"></i> Smart Handover Disabled</h3>
                    <p>This will be implemented in the future</p>
                </div>
                <div class="devices-grid" id="handoverDevices">
                    <div class="loading-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>SMART HANDOVER DISABLED</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="paymentContent">
                <div class="tab-header">
                    <h3><i class="fas fa-cash-register"></i> Payment Collection</h3>
                    <p>Completed devices awaiting payment from customers</p>
                </div>
                <div class="devices-grid" id="paymentDevices">
                    <div class="loading-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading devices awaiting payment...</p>
                    </div>
                </div>
            </div>

            <div class="tab-content" id="returnsContent">
                <div class="tab-header">
                    <h3><i class="fas fa-exclamation-triangle"></i> Device Returns</h3>
                    <p>Devices that cannot be repaired and need to be returned</p>
                </div>
                <div class="devices-grid" id="returnsDevices">
                    <div class="loading-placeholder">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading devices for return...</p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Device Registration Modal -->
    <div class="modal" id="registrationModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3><i class="fas fa-plus"></i> New Device Registration</h3>
                <button class="close-modal" onclick="closeModal('registrationModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="deviceRegistrationForm" class="registration-form">
                    <!-- Customer Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-user"></i> Customer Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Customer Name *</label>
                                <input type="text" id="customerName" required>
                            </div>
                            <div class="form-group">
                                <label>Mobile Number *</label>
                                <input type="tel" id="customerMobile" required pattern="[0-9]{10}">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email Address</label>
                                <input type="email" id="customerEmail">
                            </div>
                            <div class="form-group">
                                <label>Address</label>
                                <textarea id="customerAddress" rows="2"></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Device Section -->
                    <div class="form-section">
                        <h4><i class="fas fa-mobile"></i> Device Information</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Device Brand *</label>
                                <input type="text" id="deviceBrand" list="brandSuggestions" required>
                                <datalist id="brandSuggestions">
                                    <option value="iPhone">
                                    <option value="Samsung">
                                    <option value="OnePlus">
                                    <option value="Xiaomi">
                                    <option value="Oppo">
                                    <option value="Vivo">
                                    <option value="Google">
                                    <option value="Realme">
                                    <option value="Nothing">
                                </datalist>
                            </div>
                            <div class="form-group">
                                <label>Device Model *</label>
                                <input type="text" id="deviceModel" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label>Problem Description *</label>
                                <textarea id="deviceProblem" required rows="3"></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Estimated Cost (₹) *</label>
                                <input type="number" id="estimatedCost" required min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label>Priority Level</label>
                                <select id="priorityLevel" required>
                                    <option value="Low">Low Priority (3-5 days)</option>
                                    <option value="Normal" selected>Normal Priority (1-3 days)</option>
                                    <option value="High">High Priority (Same day +30%)</option>
                                    <option value="Urgent">Urgent Priority (2 hours +50%)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn secondary" onclick="closeModal('registrationModal')">Cancel</button>
                <button class="btn primary" id="submitRegistration">
                    <i class="fas fa-save"></i>
                    Register Device
                </button>
            </div>
        </div>
    </div>
    <!-- Print Receipt Modal -->
<div class="modal" id="printReceiptModal">
    <div class="modal-content receipt-modal">
        <div class="modal-header">
            <h3><i class="fas fa-receipt"></i> Print Receipt</h3>
            <button class="close-modal" onclick="closeModal('printReceiptModal')">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <div class="print-preview" id="printPreview">
                <!-- Receipt content will be loaded here -->
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn secondary" onclick="closeModal('printReceiptModal')">Cancel</button>
            <button class="btn primary" onclick="printDualReceipt()">
                <i class="fas fa-print"></i>
                Print Receipt
            </button>
        </div>
    </div>
</div>

<!-- Hidden print section -->
<div id="printableReceipt" style="display: none;">
    <!-- Dual receipt content will be generated here -->
</div>


    <!-- Payment Collection Modal -->
    <!-- Payment Collection Modal -->
<!-- Payment Collection Modal -->
<div id="paymentModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-money-bill-wave"></i> Collect Payment</h3>
            <button class="close-modal" onclick="closeModal('paymentModal')">×</button>
        </div>
        <div class="modal-body">
            <div id="paymentDeviceDetails"></div>
            
            <!-- Payment Mode Selection -->
            <div class="form-section" style="margin-top: 1.5rem;">
                <h4><i class="fas fa-calculator"></i> Payment Collection</h4>
                
                <div class="payment-mode-selector">
                    <label class="payment-mode-option disabled-option">
    <input type="radio" name="paymentMode" value="single" checked disabled>
    <span class="radio-custom"></span>
    <div class="mode-info">
        <strong>Single Payment</strong>
        <p>Customer pays using one method</p>
    </div>
</label>
                    <label class="payment-mode-option">
                        <input type="radio" name="paymentMode" value="split">
                        <span class="radio-custom"></span>
                        <div class="mode-info">
                            <strong>Collect Payment</strong>
                            <p>Customer can pay using multiple methods</p>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Single Payment Section -->
            <div id="singlePaymentSection" class="payment-section">
                <div class="form-row">
                    <div class="form-group">
                        <label for="finalAmount">Final Amount:</label>
                        <input type="number" id="finalAmount" placeholder="Enter amount in ₹" min="0" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label for="paymentMethod">Payment Method:</label>
                        <select id="paymentMethod" required>
                            <option value="">Select payment method</option>
                            <option value="cash">Cash</option>
                            <option value="upi">UPI/Online</option>
                            <option value="card">Card/POS</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Split Payment Section -->
            <div id="splitPaymentSection" class="payment-section" style="display: none;">
                <div class="split-payment-header">
                    <div class="total-amount-display">
                        <label for="splitTotalAmount">Total Amount to Collect:</label>
                        <input type="number" id="splitTotalAmount" placeholder="Enter total amount in ₹" min="0" step="0.01" class="total-amount-input">
                    </div>
                </div>

                <div class="split-payments-container">
                    <h5><i class="fas fa-divide"></i> Split Payments</h5>
                    <div id="splitPaymentsList">
                        <!-- Split payment items will be added here -->
                    </div>
                    
                    <button type="button" id="addSplitPayment" class="btn secondary add-split-btn">
                        <i class="fas fa-plus"></i> Add Payment Method
                    </button>
                </div>

                <div class="split-payment-summary">
                    <div class="summary-row">
                        <span>Total Amount:</span>
                        <span id="summaryTotal">₹0</span>
                    </div>
                    <div class="summary-row">
                        <span>Collected:</span>
                        <span id="summaryCollected">₹0</span>
                    </div>
                    <div class="summary-row balance-row">
                        <span>Remaining:</span>
                        <span id="summaryRemaining">₹0</span>
                    </div>
                </div>
            </div>

            <div class="payment-notes-section">
                <label for="paymentNotes">Payment Notes (Optional):</label>
                <textarea id="paymentNotes" rows="2" placeholder="Any additional notes about the payment..."></textarea>
            </div>
            
            <p class="payment-info"><strong>This payment will be recorded and the device will be removed from pending list.</strong></p>
        </div>
        <div class="modal-footer">
            <button class="btn secondary" onclick="closeModal('paymentModal')">Cancel</button>
            <button id="confirmPayment" class="btn primary">
                <i class="fas fa-check"></i> Collect Payment
            </button>
        </div>
    </div>
</div>


<div id="returnModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-undo"></i> Confirm Device Return</h3>
            <button class="close-modal" onclick="closeModal('returnModal')">×</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to return this unrepairable device to the customer?</p>
            <div id="returnDeviceDetails"></div>
            <p><strong>This action will remove the device from the returns list.</strong></p>
        </div>
        <div class="modal-footer">
            <button class="btn secondary" onclick="closeModal('returnModal')">Cancel</button>
            <button id="confirmReturn" class="btn primary">
                <i class="fas fa-check"></i> Return Device
            </button>
        </div>
    </div>
</div>
    <!-- Handover Confirmation Modal -->
    <div id="handoverModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-hand-holding"></i> Confirm Device Handover</h3>
            <button class="close-modal" onclick="closeModal('handoverModal')">×</button>
        </div>
        <div class="modal-body">
            <p>Are you sure you want to hand over this device to the customer?</p>
            <div id="handoverDeviceDetails"></div>
            <p><strong>This action cannot be undone and the device will be removed from the dashboard.</strong></p>
        </div>
        <div class="modal-footer">
            <button class="btn secondary" onclick="closeModal('handoverModal')">Cancel</button>
            <button id="confirmHandover" class="btn primary">
                <i class="fas fa-check"></i> Confirm Handover
            </button>
        </div>
    </div>
</div>

    <!-- Success/Receipt Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-check-circle"></i> Success</h3>
                <button class="close-modal" onclick="closeModal('successModal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="successModalBody">
                <!-- Success content will be loaded here -->
            </div>
            <div class="modal-footer">
                <button class="btn primary" onclick="closeModal('successModal')">Close</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jsbarcode/3.11.5/JsBarcode.all.min.js"></script>
    <script src="firebase-config.js"></script>
    <script type="module" src="script.js"></script>

    <!--Additional JS for Split Payment methods-->
    <script src="split-payment.js"></script>
</body>
</html>
